{"ast":null,"code":"import { ethers } from \"ethers\";\nimport PropertyNFT from \"./PropertyNFT.json\"; // ABI from Hardhat artifacts\n\nconst CONTRACT_ADDRESS = \"0x5FbDB2315678afecb367f032d93F642f64180aa3\";\n\n// Use MetaMask for sending transactions (write)\nexport async function getProvider() {\n  if (window.ethereum) {\n    await window.ethereum.request({\n      method: \"eth_requestAccounts\"\n    });\n    return new ethers.providers.Web3Provider(window.ethereum);\n  }\n  throw new Error(\"MetaMask not found\");\n}\n\n// Use Hardhat node directly for reads (bypasses ENS logic)\nexport function getReadProvider() {\n  return new ethers.providers.JsonRpcProvider(\"http://localhost:8545\");\n}\n\n// Signer for sending transactions\nexport async function getSigner() {\n  const provider = await getProvider();\n  return provider.getSigner();\n}\n\n// Contract instance for writing (MetaMask signer)\nexport async function getContract() {\n  const signer = await getSigner();\n  return new ethers.Contract(CONTRACT_ADDRESS, PropertyNFT.abi, signer);\n}\n\n// Contract instance for reads (local provider)\nexport function getReadContract() {\n  const provider = getReadProvider();\n  return new ethers.Contract(CONTRACT_ADDRESS, PropertyNFT.abi, provider);\n}\n\n// Read NFTs for an address\nexport async function getMyNFTs(address) {\n  const contract = getReadContract();\n  const balance = await contract.balanceOf(address);\n  let nfts = [];\n  for (let i = 0; i < balance; i++) {\n    const tokenId = await contract.tokenOfOwnerByIndex(address, i);\n    const data = await contract.getProperty(tokenId);\n    nfts.push({\n      tokenId: tokenId.toString(),\n      ...parsePropertyData(data)\n    });\n  }\n  return nfts;\n}\nfunction parsePropertyData([itemType, name, value, purchaseDate, vin, addr]) {\n  return {\n    itemType,\n    name,\n    value: value.toString(),\n    purchaseDate,\n    vin,\n    addr\n  };\n}\n\n// Create an offer (write)\nexport async function createOffer(tokenId, buyer, priceEth) {\n  const contract = await getContract();\n  const price = ethers.utils.parseEther(priceEth);\n  const tx = await contract.createOffer(tokenId, buyer, price);\n  await tx.wait();\n}\n\n// Get pending offers for an address (read)\nexport async function getPendingOffers(address) {\n  const contract = getReadContract();\n  const offers = await contract.getPendingOffers(address);\n  return offers.map(o => ({\n    offerId: o.offerId.toString(),\n    tokenId: o.tokenId.toString(),\n    seller: o.seller,\n    buyer: o.buyer,\n    price: ethers.utils.formatEther(o.price),\n    active: o.active\n  }));\n}\n\n// Accept an offer (write)\nexport async function acceptOffer(offerId, priceEth) {\n  const contract = await getContract();\n  const overrides = {\n    value: ethers.utils.parseEther(priceEth)\n  };\n  const tx = await contract.acceptOffer(offerId, overrides);\n  await tx.wait();\n}\n\n// ETH balance for any address (read)\nexport async function getEthBalance(address) {\n  console.log('getEthBalance called with:', address);\n  if (!address || typeof address !== \"string\" || !address.startsWith(\"0x\") || address.length !== 42) {\n    return \"0\";\n  }\n  const provider = getReadProvider();\n  try {\n    const bal = await provider.getBalance(address);\n    return ethers.utils.formatEther(bal);\n  } catch (e) {\n    console.error('Error in getBalance:', e);\n    return \"0\";\n  }\n}","map":{"version":3,"names":["ethers","PropertyNFT","CONTRACT_ADDRESS","getProvider","window","ethereum","request","method","providers","Web3Provider","Error","getReadProvider","JsonRpcProvider","getSigner","provider","getContract","signer","Contract","abi","getReadContract","getMyNFTs","address","contract","balance","balanceOf","nfts","i","tokenId","tokenOfOwnerByIndex","data","getProperty","push","toString","parsePropertyData","itemType","name","value","purchaseDate","vin","addr","createOffer","buyer","priceEth","price","utils","parseEther","tx","wait","getPendingOffers","offers","map","o","offerId","seller","formatEther","active","acceptOffer","overrides","getEthBalance","console","log","startsWith","length","bal","getBalance","e","error"],"sources":["C:/Users/Rares Manolescu/Desktop/blockchain-property-app/frontend/src/contractUtils.js"],"sourcesContent":["import { ethers } from \"ethers\";\r\nimport PropertyNFT from \"./PropertyNFT.json\"; // ABI from Hardhat artifacts\r\n\r\nconst CONTRACT_ADDRESS = \"0x5FbDB2315678afecb367f032d93F642f64180aa3\";\r\n\r\n// Use MetaMask for sending transactions (write)\r\nexport async function getProvider() {\r\n  if (window.ethereum) {\r\n    await window.ethereum.request({ method: \"eth_requestAccounts\" });\r\n    return new ethers.providers.Web3Provider(window.ethereum);\r\n  }\r\n  throw new Error(\"MetaMask not found\");\r\n}\r\n\r\n// Use Hardhat node directly for reads (bypasses ENS logic)\r\nexport function getReadProvider() {\r\n  return new ethers.providers.JsonRpcProvider(\"http://localhost:8545\");\r\n}\r\n\r\n// Signer for sending transactions\r\nexport async function getSigner() {\r\n  const provider = await getProvider();\r\n  return provider.getSigner();\r\n}\r\n\r\n// Contract instance for writing (MetaMask signer)\r\nexport async function getContract() {\r\n  const signer = await getSigner();\r\n  return new ethers.Contract(CONTRACT_ADDRESS, PropertyNFT.abi, signer);\r\n}\r\n\r\n// Contract instance for reads (local provider)\r\nexport function getReadContract() {\r\n  const provider = getReadProvider();\r\n  return new ethers.Contract(CONTRACT_ADDRESS, PropertyNFT.abi, provider);\r\n}\r\n\r\n// Read NFTs for an address\r\nexport async function getMyNFTs(address) {\r\n  const contract = getReadContract();\r\n  const balance = await contract.balanceOf(address);\r\n  let nfts = [];\r\n  for (let i = 0; i < balance; i++) {\r\n    const tokenId = await contract.tokenOfOwnerByIndex(address, i);\r\n    const data = await contract.getProperty(tokenId);\r\n    nfts.push({\r\n      tokenId: tokenId.toString(),\r\n      ...parsePropertyData(data)\r\n    });\r\n  }\r\n  return nfts;\r\n}\r\n\r\nfunction parsePropertyData([itemType, name, value, purchaseDate, vin, addr]) {\r\n  return {\r\n    itemType, name, value: value.toString(), purchaseDate, vin, addr\r\n  };\r\n}\r\n\r\n// Create an offer (write)\r\nexport async function createOffer(tokenId, buyer, priceEth) {\r\n  const contract = await getContract();\r\n  const price = ethers.utils.parseEther(priceEth);\r\n  const tx = await contract.createOffer(tokenId, buyer, price);\r\n  await tx.wait();\r\n}\r\n\r\n// Get pending offers for an address (read)\r\nexport async function getPendingOffers(address) {\r\n  const contract = getReadContract();\r\n  const offers = await contract.getPendingOffers(address);\r\n  return offers.map(o => ({\r\n    offerId: o.offerId.toString(),\r\n    tokenId: o.tokenId.toString(),\r\n    seller: o.seller,\r\n    buyer: o.buyer,\r\n    price: ethers.utils.formatEther(o.price),\r\n    active: o.active\r\n  }));\r\n}\r\n\r\n// Accept an offer (write)\r\nexport async function acceptOffer(offerId, priceEth) {\r\n  const contract = await getContract();\r\n  const overrides = {\r\n    value: ethers.utils.parseEther(priceEth)\r\n  };\r\n  const tx = await contract.acceptOffer(offerId, overrides);\r\n  await tx.wait();\r\n}\r\n\r\n// ETH balance for any address (read)\r\nexport async function getEthBalance(address) {\r\n  console.log('getEthBalance called with:', address);\r\n  if (\r\n    !address ||\r\n    typeof address !== \"string\" ||\r\n    !address.startsWith(\"0x\") ||\r\n    address.length !== 42\r\n  ) {\r\n    return \"0\";\r\n  }\r\n  const provider = getReadProvider();\r\n  try {\r\n    const bal = await provider.getBalance(address);\r\n    return ethers.utils.formatEther(bal);\r\n  } catch (e) {\r\n    console.error('Error in getBalance:', e);\r\n    return \"0\";\r\n  }\r\n}\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}